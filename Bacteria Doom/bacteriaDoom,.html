<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bacteria Shooter</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #1a0e0e, #2d1810);
            font-family: 'Courier New', monospace;
            overflow: hidden;
            color: #ff6b35;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            border: 3px solid #ff6b35;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.5);
            background: radial-gradient(circle at center, #0f2027, #203a43, #2c5364);
        }

        #ui, #plantInfo {
            position: absolute;
            top: 20px;
            z-index: 10;
            color: #ff6b35;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        #ui {
            left: 20px;
        }
        
        #plantInfo {
            right: 20px;
            text-align: right;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            color: #ff6b35;
            font-size: 14px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .button {
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            border: none;
            padding: 10px 20px;
            margin: 5px;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
        }

        #gameTitle {
            font-size: 48px;
            color: #ff6b35;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        #soundToggle {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid #ff6b35;
            color: #ff6b35;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        
        /* --- MEDIA QUERIES --- */

        /* Tablet responsiveness */
        @media (max-width: 768px) {
            #gameCanvas {
                width: 90%;
                height: auto;
            }

            #ui, #plantInfo {
                font-size: 12px;
                top: 10px;
            }
            
            #ui {
                left: 10px;
            }
            
            #plantInfo {
                right: 10px;
            }

            #gameTitle {
                font-size: 36px;
                margin-bottom: 20px;
            }
            
            #startScreen p {
                font-size: 16px !important;
            }
            
            #controls {
                font-size: 12px;
            }

            .button {
                padding: 8px 16px;
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 480px) {
            #gameCanvas {
                width: 100%;
                height: auto;
            }

            #ui, #plantInfo {
                font-size: 10px;
                top: 5px;
            }

            #ui {
                left: 5px;
            }
            
            #plantInfo {
                right: 5px;
            }

            #soundToggle {
                top: auto;
                bottom: 10px;
                left: 10px;
                transform: none;
                padding: 5px 10px;
                font-size: 10px;
            }
            
            #startScreen p {
                font-size: 14px !important;
            }

            #gameTitle {
                font-size: 28px;
                margin-bottom: 15px;
            }

            .button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            #controls {
                font-size: 10px;
                bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="startScreen">
            <div id="gameTitle">ü¶† BACTERIA SHOOTER üßü</div>
            <p style="font-size: 18px; margin-bottom: 30px;">Defend against endless zombie hordes!</p>
            <button class="button" onclick="startGame()">START BATTLE</button>
            <div style="margin-top: 20px; font-size: 14px;">
                <p>üéÆ WASD to move | Mouse to aim & shoot | SPACE to change bacteria</p>
            </div>
        </div>

        <button id="soundToggle" onclick="toggleSound()">üîä Sound: ON</button>

        <canvas id="gameCanvas" width="900" height="600"></canvas>
        
        <div id="ui">
            <div>üíÄ Score: <span id="score">0</span></div>
            <div>üèÜ High Score: <span id="highScore">0</span></div>
            <div>‚ö° Health: <span id="health">100</span></div>
            <div>üåä Wave: <span id="wave">1</span></div>
        </div>

        <div id="plantInfo">
            <div>ü¶† Bacteria: <span id="currentPlant">Streptoblast</span></div>
            <div>‚öîÔ∏è Damage: <span id="damage">20</span></div>
            <div>üî• Fire Rate: <span id="fireRate">Fast</span></div>
            <div>üí´ Special: <span id="special">Rapid Fire</span></div>
        </div>

        <div id="controls">
            <div>WASD: Move | Mouse: Aim & Shoot | SPACE: Change Bacteria</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Adjust canvas dimensions for mobile
        function resizeCanvas() {
            if (window.innerWidth < 768) {
                canvas.width = window.innerWidth * 0.9;
                canvas.height = window.innerHeight * 0.6;
            } else {
                canvas.width = 900;
                canvas.height = 600;
            }
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let soundEnabled = true;
        let audioContext;
        
        function initAudio() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
        }

        function playSound(freq, dur, type = 'sine', vol = 0.3) {
            if (!soundEnabled || !audioContext) return;
            try {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.frequency.value = freq;
                osc.type = type;
                gain.gain.setValueAtTime(vol, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + dur);
                osc.start();
                osc.stop(audioContext.currentTime + dur);
            } catch (e) {
                console.log('Sound error:', e);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').innerHTML = soundEnabled ? 'üîä Sound: ON' : 'üîá Sound: OFF';
        }
        
        let game = {
            player: { x: 450, y: 300, size: 25, health: 100, maxHealth: 100, currentPlant: 0 },
            score: 0,
            highScore: localStorage.getItem('plantDoomHighScore') || 0,
            wave: 1,
            gameRunning: false,
            keys: {},
            mouse: { x: 0, y: 0 },
            lastShot: 0,
            bullets: [],
            zombies: [],
            particles: [],
            zombieSpawnRate: 2000,
            lastZombieSpawn: 0
        };

        const plants = [
            {
                name: 'Streptoblast',
                color: '#00E676',
                damage: 20,
                fireRate: 300,
                bulletColor: '#69F0AE',
                bulletSize: 4,
                description: 'Fast',
                special: 'Rapid Spores'
            },
            {
                name: 'Luminococcus',
                color: '#FFD700',
                damage: 35,
                fireRate: 500,
                bulletColor: '#FFF176',
                bulletSize: 6,
                description: 'Medium',
                special: 'Bio Flash'
            },
            {
                name: 'Pyroblast',
                color: '#F44336',
                damage: 50,
                fireRate: 800,
                bulletColor: '#FF5722',
                bulletSize: 8,
                description: 'Slow',
                special: 'Toxic Burst'
            }
        ];

        const zombieTypes = [
            { name: 'Basic', color: '#8BC34A', speed: 1, healthMult: 1, sizeMult: 1 },
            { name: 'Fast', color: '#FFEB3B', speed: 2, healthMult: 0.7, sizeMult: 0.8 },
            { name: 'Tank', color: '#9C27B0', speed: 0.5, healthMult: 2, sizeMult: 1.5 }
        ];

        // Event listeners
        document.addEventListener('keydown', (e) => {
            initAudio();
            game.keys[e.key.toLowerCase()] = true;
            if (e.key === ' ') {
                e.preventDefault();
                changePlant();
            }
        });

        document.addEventListener('keyup', (e) => {
            game.keys[e.key.toLowerCase()] = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            game.mouse.x = e.clientX - rect.left;
            game.mouse.y = e.clientY - rect.top;
        });

        canvas.addEventListener('click', (e) => {
            initAudio();
            if (game.gameRunning) shoot();
        });

        function startGame() {
            initAudio();
            document.getElementById('startScreen').style.display = 'none';
            game.gameRunning = true;
            game.score = 0;
            game.wave = 1;
            game.player.health = game.player.maxHealth;
            game.bullets = [];
            game.zombies = [];
            game.particles = [];
            game.zombieSpawnRate = 2000;
            document.getElementById('highScore').textContent = game.highScore;
            updateUI();
            playSound(600, 0.2);
            setTimeout(() => playSound(800, 0.2), 200);
            gameLoop();
        }

        function changePlant() {
            game.player.currentPlant = (game.player.currentPlant + 1) % plants.length;
            playSound(550, 0.12);
            updateUI();
        }

        function shoot() {
            const currentTime = Date.now();
            const currentPlant = plants[game.player.currentPlant];
            
            if (currentTime - game.lastShot > currentPlant.fireRate) {
                const angle = Math.atan2(game.mouse.y - game.player.y, game.mouse.x - game.player.x);
                
                game.bullets.push({
                    x: game.player.x,
                    y: game.player.y,
                    dx: Math.cos(angle) * 8,
                    dy: Math.sin(angle) * 8,
                    damage: currentPlant.damage,
                    color: currentPlant.bulletColor,
                    size: currentPlant.bulletSize,
                    plant: game.player.currentPlant
                });
                
                game.lastShot = currentTime;
                
                // Different sound for Streptoblast (green bacteria)
                if (game.player.currentPlant === 0) {
                    playSound(850, 0.06, 'sawtooth', 0.2);
                } else {
                    playSound(1200, 0.08, 'triangle', 0.25);
                }
                
                // Muzzle flash
                for (let i = 0; i < 8; i++) {
                    game.particles.push({
                        x: game.player.x + Math.cos(angle) * 30,
                        y: game.player.y + Math.sin(angle) * 30,
                        dx: (Math.random() - 0.5) * 6,
                        dy: (Math.random() - 0.5) * 6,
                        life: 25,
                        maxLife: 25,
                        color: currentPlant.bulletColor,
                        size: Math.random() * 4 + 2
                    });
                }
            }
        }

        function spawnZombie() {
            const currentTime = Date.now();
            if (currentTime - game.lastZombieSpawn > game.zombieSpawnRate) {
                const side = Math.floor(Math.random() * 4);
                let x, y;
                
                switch(side) {
                    case 0: x = -50; y = Math.random() * canvas.height; break;
                    case 1: x = canvas.width + 50; y = Math.random() * canvas.height; break;
                    case 2: x = Math.random() * canvas.width; y = -50; break;
                    case 3: x = Math.random() * canvas.width; y = canvas.height + 50; break;
                }
                
                const waveMultiplier = 1 + (game.wave - 1) * 0.3;
                const zombieType = zombieTypes[Math.floor(Math.random() * Math.min(zombieTypes.length, 1 + Math.floor(game.wave / 3)))];
                const health = Math.floor(30 * waveMultiplier * zombieType.healthMult);
                const size = Math.min((15 + game.wave * 2) * zombieType.sizeMult, 50);
                
                game.zombies.push({
                    x: x, y: y,
                    health: health,
                    maxHealth: health,
                    size: size,
                    speed: (Math.random() * 1.5 + 0.5) * zombieType.speed,
                    type: zombieType,
                    animation: Math.random() * Math.PI * 2,
                    lastHit: 0
                });
                
                game.lastZombieSpawn = currentTime;
                if (game.zombieSpawnRate > 500) game.zombieSpawnRate -= 30;
            }
        }

        function updateGame() {
            // Player movement
            const moveSpeed = 5;
            if (game.keys['w']) game.player.y -= moveSpeed;
            if (game.keys['s']) game.player.y += moveSpeed;
            if (game.keys['a']) game.player.x -= moveSpeed;
            if (game.keys['d']) game.player.x += moveSpeed;
            
            game.player.x = Math.max(game.player.size, Math.min(canvas.width - game.player.size, game.player.x));
            game.player.y = Math.max(game.player.size, Math.min(canvas.height - game.player.size, game.player.y));
            
            // Update bullets
            for (let i = game.bullets.length - 1; i >= 0; i--) {
                const bullet = game.bullets[i];
                bullet.x += bullet.dx;
                bullet.y += bullet.dy;
                
                if (Math.random() < 0.3) {
                    game.particles.push({
                        x: bullet.x + (Math.random() - 0.5) * 4,
                        y: bullet.y + (Math.random() - 0.5) * 4,
                        dx: (Math.random() - 0.5) * 2,
                        dy: (Math.random() - 0.5) * 2,
                        life: 15,
                        maxLife: 15,
                        color: bullet.color,
                        size: bullet.size * 0.5
                    });
                }
                
                if (bullet.x < -20 || bullet.x > canvas.width + 20 || bullet.y < -20 || bullet.y > canvas.height + 20) {
                    game.bullets.splice(i, 1);
                }
            }
            
            // Update zombies
            for (let zombie of game.zombies) {
                const angle = Math.atan2(game.player.y - zombie.y, game.player.x - zombie.x);
                zombie.x += Math.cos(angle) * zombie.speed;
                zombie.y += Math.sin(angle) * zombie.speed;
                zombie.animation += 0.1;
                
                if (Math.random() < 0.1) {
                    game.particles.push({
                        x: zombie.x + (Math.random() - 0.5) * zombie.size,
                        y: zombie.y + (Math.random() - 0.5) * zombie.size,
                        dx: (Math.random() - 0.5) * 1,
                        dy: (Math.random() - 0.5) * 1,
                        life: 30,
                        maxLife: 30,
                        color: zombie.type.color,
                        size: 1
                    });
                }
            }
            
            // Collision detection
            for (let i = game.bullets.length - 1; i >= 0; i--) {
                const bullet = game.bullets[i];
                for (let j = game.zombies.length - 1; j >= 0; j--) {
                    const zombie = game.zombies[j];
                    const dx = bullet.x - zombie.x;
                    const dy = bullet.y - zombie.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < zombie.size + bullet.size) {
                        zombie.health -= bullet.damage;
                        zombie.lastHit = Date.now();
                        game.bullets.splice(i, 1);
                        
                        playSound(350, 0.15, 'triangle', 0.35);
                        
                        // Hit particles
                        for (let k = 0; k < 12; k++) {
                            game.particles.push({
                                x: zombie.x + (Math.random() - 0.5) * zombie.size,
                                y: zombie.y + (Math.random() - 0.5) * zombie.size,
                                dx: (Math.random() - 0.5) * 8,
                                dy: (Math.random() - 0.5) * 8,
                                life: 35,
                                maxLife: 35,
                                color: '#FF0000',
                                size: Math.random() * 3 + 1
                            });
                        }
                        
                        // Special effects
                        if (bullet.plant === 2) {
                            for (let k = 0; k < 20; k++) {
                                game.particles.push({
                                    x: zombie.x,
                                    y: zombie.y,
                                    dx: (Math.random() - 0.5) * 12,
                                    dy: (Math.random() - 0.5) * 12,
                                    life: 50,
                                    maxLife: 50,
                                    color: ['#FF5722', '#FF9800', '#FFC107'][Math.floor(Math.random() * 3)],
                                    size: Math.random() * 6 + 3
                                });
                            }
                        }
                        
                        if (zombie.health <= 0) {
                            game.score += Math.floor(10 * (1 + game.wave * 0.1) * zombie.type.healthMult);
                            game.zombies.splice(j, 1);
                            playSound(120, 0.6, 'sine', 0.3);
                            setTimeout(() => playSound(80, 0.4, 'square', 0.25), 150);
                            
                            // Death explosion
                            for (let k = 0; k < 25; k++) {
                                game.particles.push({
                                    x: zombie.x,
                                    y: zombie.y,
                                    dx: (Math.random() - 0.5) * 10,
                                    dy: (Math.random() - 0.5) * 10,
                                    life: 60,
                                    maxLife: 60,
                                    color: ['#FF6B35', '#FF8C42', '#FFA726', zombie.type.color][Math.floor(Math.random() * 4)],
                                    size: Math.random() * 5 + 2
                                });
                            }
                        }
                        break;
                    }
                }
            }
            
            // Player-zombie collision
            for (let zombie of game.zombies) {
                const dx = game.player.x - zombie.x;
                const dy = game.player.y - zombie.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < game.player.size + zombie.size) {
                    game.player.health -= 2;
                    playSound(450, 0.25, 'sine', 0.4);
                    
                    for (let i = 0; i < 8; i++) {
                        game.particles.push({
                            x: game.player.x,
                            y: game.player.y,
                            dx: (Math.random() - 0.5) * 6,
                            dy: (Math.random() - 0.5) * 6,
                            life: 30,
                            maxLife: 30,
                            color: '#FF0000',
                            size: Math.random() * 3 + 1
                        });
                    }
                    
                    if (game.player.health <= 0) {
                        gameOver();
                        return;
                    }
                }
            }
            
            // Update particles
            for (let i = game.particles.length - 1; i >= 0; i--) {
                const particle = game.particles[i];
                particle.x += particle.dx;
                particle.y += particle.dy;
                particle.life--;
                particle.dx *= 0.98;
                particle.dy *= 0.98;
                
                if (particle.life <= 0) {
                    game.particles.splice(i, 1);
                }
            }
            
            // Wave progression
            if (game.zombies.length === 0 && Date.now() - game.lastZombieSpawn > 3000) {
                game.wave++;
                game.zombieSpawnRate = Math.max(500, 2000 - game.wave * 80);
                playSound(750, 0.15);
                setTimeout(() => playSound(950, 0.15), 150);
                updateUI();
            }
            
            spawnZombie();
            updateUI();
        }

        function render() {
            // Clear with gradient
            const gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width/2);
            gradient.addColorStop(0, '#0f2027');
            gradient.addColorStop(0.5, '#203a43');
            gradient.addColorStop(1, '#2c5364');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Grid
            ctx.strokeStyle = 'rgba(255, 107, 53, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 40) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // Draw particles
            for (let particle of game.particles) {
                ctx.save();
                ctx.globalAlpha = particle.life / particle.maxLife;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            
            // Draw bullets
            for (let bullet of game.bullets) {
                ctx.fillStyle = bullet.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
            
            // Draw zombies
            for (let zombie of game.zombies) {
                const isHit = Date.now() - zombie.lastHit < 200;
                
                if (isHit) {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.arc(zombie.x, zombie.y, zombie.size + 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
                
                // Shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.ellipse(zombie.x, zombie.y + zombie.size, zombie.size * 0.8, zombie.size * 0.3, 0, 0, Math.PI * 2);
                ctx.fill();
                
                const wobble = Math.sin(zombie.animation) * 2;
                
                // Body
                ctx.fillStyle = zombie.type.color;
                ctx.strokeStyle = '#654321';
                ctx.lineWidth = 2;
                ctx.shadowBlur = 8;
                ctx.shadowColor = zombie.type.color;
                ctx.beginPath();
                ctx.arc(zombie.x, zombie.y + wobble, zombie.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                ctx.shadowBlur = 0;
                
                // Eyes
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(zombie.x - zombie.size * 0.3, zombie.y - zombie.size * 0.2 + wobble, zombie.size * 0.2, zombie.size * 0.2);
                ctx.fillRect(zombie.x + zombie.size * 0.1, zombie.y - zombie.size * 0.2 + wobble, zombie.size * 0.2, zombie.size * 0.2);
                
                // Eye glow
                ctx.fillStyle = '#FFFF00';
                ctx.fillRect(zombie.x - zombie.size * 0.25, zombie.y - zombie.size * 0.15 + wobble, zombie.size * 0.1, zombie.size * 0.1);
                ctx.fillRect(zombie.x + zombie.size * 0.15, zombie.y - zombie.size * 0.15 + wobble, zombie.size * 0.1, zombie.size * 0.1);
                
                // Health bar
                const barWidth = zombie.size * 1.5;
                const barHeight = 4;
                const healthPercent = zombie.health / zombie.maxHealth;
                
                ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                ctx.fillRect(zombie.x - barWidth/2, zombie.y - zombie.size - 10 + wobble, barWidth, barHeight);
                
                ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';
                ctx.fillRect(zombie.x - barWidth/2, zombie.y - zombie.size - 10 + wobble, barWidth * healthPercent, barHeight);
            }
            
            // Draw player
            const currentPlant = plants[game.player.currentPlant];
            
            // Plant body
            ctx.fillStyle = currentPlant.color;
            ctx.strokeStyle = '#00BCD4';
            ctx.lineWidth = 3;
            ctx.shadowBlur = 15;
            ctx.shadowColor = currentPlant.color;
            ctx.beginPath();
            ctx.arc(game.player.x, game.player.y, game.player.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Player aiming line
            const aimAngle = Math.atan2(game.mouse.y - game.player.y, game.mouse.x - game.player.x);
            const aimLineLength = game.player.size + 15;
            ctx.strokeStyle = currentPlant.bulletColor;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(game.player.x + Math.cos(aimAngle) * game.player.size, game.player.y + Math.sin(aimAngle) * game.player.size);
            ctx.lineTo(game.player.x + Math.cos(aimAngle) * aimLineLength, game.player.y + Math.sin(aimAngle) * aimLineLength);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.shadowBlur = 0;
            
            // Bacteria details
            if (game.player.currentPlant === 0) { // Streptoblast - New vibrant design
                // Create energetic spikes radiating from center
                ctx.fillStyle = '#1DE9B6';
                ctx.strokeStyle = '#00E676';
                ctx.lineWidth = 2;
                
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    const spikeLength = game.player.size * (1.3 + Math.sin(Date.now() * 0.01 + i) * 0.2);
                    const spikeX = game.player.x + Math.cos(angle) * spikeLength;
                    const spikeY = game.player.y + Math.sin(angle) * spikeLength;
                    
                    ctx.beginPath();
                    ctx.moveTo(game.player.x, game.player.y);
                    ctx.lineTo(spikeX, spikeY);
                    ctx.stroke();
                    
                    // Glowing tip
                    ctx.fillStyle = '#64FFDA';
                    ctx.beginPath();
                    ctx.arc(spikeX, spikeY, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Central pulsing core
                const pulseSize = game.player.size * 0.4 + Math.sin(Date.now() * 0.015) * 3;
                ctx.fillStyle = '#B2DFDB';
                ctx.beginPath();
                ctx.arc(game.player.x, game.player.y, pulseSize, 0, Math.PI * 2);
                ctx.fill();
                
                // Energy rings
                ctx.strokeStyle = '#4DD0E1';
                ctx.lineWidth = 1;
                for (let r = 0; r < 3; r++) {
                    const ringRadius = game.player.size * (0.6 + r * 0.3) + Math.sin(Date.now() * 0.01 + r) * 2;
                    ctx.globalAlpha = 0.4 - r * 0.1;
                    ctx.beginPath();
                    ctx.arc(game.player.x, game.player.y, ringRadius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                ctx.globalAlpha = 1;
                
            } else if (game.player.currentPlant === 1) { // Luminococcus - Glowing petal design
                ctx.shadowColor = '#FFC107';
                ctx.shadowBlur = 20;
                
                // Draw a core
                ctx.fillStyle = '#FFEB3B';
                ctx.beginPath();
                ctx.arc(game.player.x, game.player.y, game.player.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw glowing petals
                ctx.fillStyle = '#FFF9C4';
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2 + Date.now() * 0.0003;
                    const petalX = game.player.x + Math.cos(angle) * game.player.size;
                    const petalY = game.player.y + Math.sin(angle) * game.player.size;
                    ctx.beginPath();
                    ctx.arc(petalX, petalY, game.player.size * 0.35, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.shadowBlur = 0;
            } else if (game.player.currentPlant === 2) { // Pyroblast - Aggressive, toxic design
                ctx.shadowColor = '#F44336';
                ctx.shadowBlur = 20;

                // Spiky core
                ctx.fillStyle = '#FF5252';
                ctx.beginPath();
                ctx.arc(game.player.x, game.player.y, game.player.size * 0.8, 0, Math.PI * 2);
                ctx.fill();
                
                // Flame-like protrusions
                ctx.strokeStyle = '#FF3D00';
                ctx.lineWidth = 4;
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2 + Date.now() * 0.0005;
                    const spikeX = game.player.x + Math.cos(angle) * game.player.size * 1.5;
                    const spikeY = game.player.y + Math.sin(angle) * game.player.size * 1.5;
                    
                    ctx.beginPath();
                    ctx.moveTo(game.player.x, game.player.y);
                    ctx.lineTo(spikeX, spikeY);
                    ctx.stroke();
                }

                // Inner toxic glow
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'rgba(255, 23, 68, 0.4)';
                const innerGlowRadius = game.player.size * 0.6 + Math.sin(Date.now() * 0.01) * 2;
                ctx.beginPath();
                ctx.arc(game.player.x, game.player.y, innerGlowRadius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Health bar for player
            const healthBarWidth = 100;
            const healthBarHeight = 10;
            ctx.fillStyle = '#333';
            ctx.fillRect(game.player.x - healthBarWidth / 2, game.player.y + game.player.size + 10, healthBarWidth, healthBarHeight);
            
            const healthPercent = game.player.health / game.player.maxHealth;
            ctx.fillStyle = healthPercent > 0.5 ? '#00FF00' : (healthPercent > 0.2 ? '#FFD700' : '#FF0000');
            ctx.fillRect(game.player.x - healthBarWidth / 2, game.player.y + game.player.size + 10, healthBarWidth * healthPercent, healthBarHeight);
        }

        function updateUI() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('health').textContent = Math.max(0, game.player.health);
            document.getElementById('wave').textContent = game.wave;
            const currentPlant = plants[game.player.currentPlant];
            document.getElementById('currentPlant').textContent = currentPlant.name;
            document.getElementById('damage').textContent = currentPlant.damage;
            document.getElementById('fireRate').textContent = currentPlant.description;
            document.getElementById('special').textContent = currentPlant.special;
        }

        function gameOver() {
            game.gameRunning = false;
            if (game.score > game.highScore) {
                game.highScore = game.score;
                localStorage.setItem('plantDoomHighScore', game.highScore);
            }
            document.getElementById('highScore').textContent = game.highScore;
            
            document.getElementById('startScreen').style.display = 'flex';
            const title = document.getElementById('gameTitle');
            title.innerHTML = 'GAME OVER<br>Final Score: ' + game.score;
            
            playSound(200, 0.5, 'square', 0.4);
            setTimeout(() => playSound(100, 0.8, 'square', 0.5), 200);
        }

        function gameLoop() {
            if (!game.gameRunning) return;
            
            updateGame();
            render();
            
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
